<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ ğŸ”¥</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button{font-size:18px;padding:14px 26px;margin:6px}
#tapBtn{font-size:28px;padding:32px 64px;margin-top:20px}
.hidden{display:none!important}
.boss{font-size:80px}
.player{font-size:60px;margin:10px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red;transition:.1s}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;z-index:999;font-size:26px;text-align:center;padding:20px}

.rare{color:#4af}.sr{color:#c6f}.hr{color:#fa4}.ur{color:gold}
.lr{
background:linear-gradient(45deg,red,orange,yellow,green,cyan,blue,purple);
-webkit-background-clip:text;color:transparent;font-weight:bold}

@keyframes spin{
0%{transform:scale(.3) rotate(0);opacity:0}
100%{transform:scale(1) rotate(720deg);opacity:1}
}
.spin{font-size:80px;animation:spin 1s}
</style>
</head>

<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>ğŸ’° <span id="coin">0</span>ã€€ğŸ’ <span id="dia">0</span></p>
<p>âš” æ”»æ’ƒåŠ› +<span id="atk">0</span></p>

<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£(100)</button>
<button onclick="drawDiaGacha()">ğŸ’ ä¸Šä½ã‚¬ãƒãƒ£</button>
<button onclick="exchangeDia()">ğŸ’°1000â†’ğŸ’1</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<button id="rushBtn" onclick="startRush()">ğŸ† ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥</button>

<div id="select">
<h2>ãƒœã‚¹é¸æŠ</h2>
<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',100000000)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',300,'ğŸ‘¹',20)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',500,'ğŸ‰',50)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ã‚´ãƒ¼ãƒ¬ãƒ ',1200,'ğŸ—¿',120)">ã‚´ãƒ¼ãƒ¬ãƒ </button>
<button onclick="startBattle('ãƒ‡ãƒ¼ãƒ¢ãƒ³',2500,'ğŸ˜ˆ',250)">ãƒ‡ãƒ¼ãƒ¢ãƒ³</button>
<button onclick="startBattle('ç¥ç«œ',5000,'ğŸ²âœ¨',500)">ç¥ç«œ</button>

<hr>
<h3>ğŸ”¥ è¶…é«˜é›£åº¦ ğŸ”¥</h3>
<button onclick="startBattle('ã‚«ã‚ªã‚¹ãƒ­ãƒ¼ãƒ‰',50000,'ğŸ’€',2000)">ã‚«ã‚ªã‚¹ãƒ­ãƒ¼ãƒ‰</button>
<button onclick="startBattle('è™šç„¡ã®ç‹',200000,'ğŸŒŒ',8000)">è™šç„¡ã®ç‹</button>
<button onclick="startBattle('çµ‚ç„‰ã®ç¥',1000000,'ğŸŸ¥',50000)">çµ‚ç„‰ã®ç¥</button>
</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP <span id="hpText"></span></p>
<button id="tapBtn">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿å®Œå…¨å¼•ãç¶™ãï¼ˆæœ€é‡è¦ï¼‰ ===== */
let coin = Number(localStorage.getItem("coin")) || 0
let dia  = Number(localStorage.getItem("dia"))  || 0

let atk = 0
const savedAtk = localStorage.getItem("atk")
const oldAtk   = localStorage.getItem("atkBonus")

if(savedAtk !== null && !isNaN(savedAtk)){
  atk = Number(savedAtk)
}else if(oldAtk !== null && !isNaN(oldAtk)){
  atk = Number(oldAtk)
  localStorage.setItem("atk", atk)
  localStorage.removeItem("atkBonus")
}else{
  atk = 0
}

let dex = JSON.parse(localStorage.getItem("dex") || "{}")

/* ===== çŠ¶æ…‹ ===== */
let bossHp,maxHp,reward,start,taps
let rush=false,rushCount=0,rushTimer

/* ===== DOM ===== */
const coinEl=document.getElementById("coin")
const diaEl=document.getElementById("dia")
const atkEl=document.getElementById("atk")
const ov=document.getElementById("overlay")

/* ===== ä¿å­˜ ===== */
function save(){
localStorage.setItem("coin",coin)
localStorage.setItem("dia",dia)
localStorage.setItem("atk",atk)
localStorage.setItem("dex",JSON.stringify(dex))
coinEl.textContent=coin
diaEl.textContent=dia
atkEl.textContent=atk.toFixed(1)
}

/* ===== è¦‹ãŸç›® ===== */
function updatePlayer(){
player.textContent =
atk>=20 ? "ğŸ‘‘ğŸ”¥" :
atk>=10 ? "ğŸ˜‡âœ¨" :
atk>=5  ? "ğŸ˜" : "ğŸ™‚"
}

/* åˆæœŸåæ˜ ï¼ˆã“ã“ã§åˆã‚ã¦ä¿å­˜ï¼‰ */
updatePlayer()
save()

/* ===== overlay ===== */
function showO(h){
ov.innerHTML=h+"<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>"
ov.classList.remove("hidden")
}
ov.onclick=()=>ov.classList.add("hidden")

/* ===== ã‚¬ãƒãƒ£ ===== */
function roll(tbl){
ov.classList.remove("hidden")
ov.innerHTML=`<div class="spin">ğŸ°</div>`
setTimeout(()=>{
let r=Math.random()*100,s=0
for(let g of tbl){
s+=g[1]
if(r<s){
atk+=g[2]
dex[g[0]]=(dex[g[0]]||0)+1
updatePlayer()
save()
ov.innerHTML=`<div class="${g[3]}">âœ¨${g[0]}âœ¨<br>æ”»æ’ƒåŠ›+${g[2]}</div>`
return
}}
},1000)
}

function drawGacha(){
if(coin<100)return showO("ã‚³ã‚¤ãƒ³ä¸è¶³")
coin-=100;save()
roll([
["ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰",2,1.5,"lr"],
["ã‚¦ãƒ«ãƒˆãƒ©",5,1,"ur"],
["ãƒã‚¤ãƒ‘ãƒ¼",15,.5,"hr"],
["ã‚¹ãƒ¼ãƒ‘ãƒ¼",28,.3,"sr"],
["ãƒ¬ã‚¢",50,.1,"rare"]
])
}

function drawDiaGacha(){
if(dia<1)return showO("ãƒ€ã‚¤ãƒ¤ä¸è¶³")
dia--;save()
roll([
["ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰",40,2,"lr"],
["ã‚¦ãƒ«ãƒˆãƒ©",45,1.5,"ur"],
["ãƒ‡ã‚£ãƒã‚¤ãƒ³",15,10,"hr"]
])
}

function exchangeDia(){
if(coin<1000)return showO("ä¸è¶³")
coin-=1000;dia++;save()
showO("ğŸ’ +1")
}

function showDex(){
let h="<h2>ğŸ“– å›³é‘‘</h2>"
for(let k in dex)h+=`${k} Ã—${dex[k]}<br>`
showO(h)
}

/* ===== ãƒãƒˆãƒ« ===== */
function startBattle(n,h,i,r){
rush=false
bossHp=maxHp=h;reward=r;taps=0;start=Date.now()
bossName.textContent=n
bossIcon.textContent=i
select.classList.add("hidden")
game.classList.remove("hidden")
upd()
}

function startRush(){
rush=true;rushCount=0
document.getElementById("rushBtn").classList.add("hidden")
document.getElementById("select").classList.add("hidden")
showO("ğŸ† ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥é–‹å§‹ï¼")
rushTimer=setTimeout(endRush,60000)
nextRush()
}

function nextRush(){
let hp=800 + rushCount*600
startBattle("ãƒ©ãƒƒã‚·ãƒ¥ãƒœã‚¹"+(rushCount+1),hp,"ğŸ‘¾",0)
}

function endRush(){
rush=false
game.classList.add("hidden")
select.classList.remove("hidden")
document.getElementById("rushBtn").classList.remove("hidden")
let rewardCoin=rushCount*300
coin+=rewardCoin
save()
showO(`ğŸ† çµ‚äº†ï¼<br>${rushCount}ä½“æ’ƒç ´<br>ğŸ’° +${rewardCoin}`)
}

tapBtn.onclick=()=>{
taps++
let dmg=1+atk+(taps%10===0?1:0)
bossHp=Math.max(0,bossHp-dmg)
upd()
if(bossHp===0){
if(rush){rushCount++;nextRush();return}
let t=((Date.now()-start)/1000).toFixed(2)
coin+=reward
save()
game.classList.add("hidden")
select.classList.remove("hidden")
showO(`ğŸ‰ æ’ƒç ´ï¼<br>${t}s`)
}
}

function upd(){
hpText.textContent=Math.ceil(bossHp)
hp.style.width=(bossHp/maxHp*100)+"%"
}
</script>
</body>
</html>
